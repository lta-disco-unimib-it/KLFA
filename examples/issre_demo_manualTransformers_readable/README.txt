This example shows how KLFA can be used to identifies anomalies among sequences 
of events recorded in csv files. 
This example corresponds to the one shown at ISSRE 2008.

** Infer the models

Run the script named training to infer a model.
The script infers models with the component level granularity.



The script reads the file correct.cvs which contains the valid traces.
First column shows the component name, second column the event name. 
Other columns correspond to event parameters. 
This file presents events produced by a single component whose name is "0". 
A trace file usually contains events generated by many components. 
Furthermore component names are not forced to correspond to numbers, but they 
can be any string, e.g. Server or Jsp, etc.
This file presents event names like 'Server start', 'user logout' etc. 
An event names is a  string without a predefined format, 
thus names like 'start application' or 
'shutdown' are valid event names.

Preprocessors configuration has been defined in preprocessingRules.txt: this 
file presents regular expressions that match component-event pairs and permit 
to associate the event parameters to the different data clusters.

For example:

0,user logout,0:COMPONENT,1:EVENT,2:USER,3:IP

indicates that for the event 'user logout' generated by component '0' KLFA must analyze 
parameters in this manner: 
	the 1st column corresponds to cluster COMPONENT
	the 2nd column corresponds to cluster EVENT
	the 3rd column corresponds to cluster USER
	the 4th column corresponds to cluster IP
	


A user could define the rule in this manner	

0,user .*,0:COMPONENT,1:EVENT,2:USER,3:IP

that usees a regular expression to indicate that rule described before holds for
 events 'user logged in', 'user modify profile', 'user profile modified', 
 'user logout'.
 
	
Transformers configuration has been manually defined in transformersConfig.txt: 
this file indicates the data transformation rules to apply to the different data 
clusters identified manually.

File content is the following:

IP,RA
SERVER_IP,RA
USER,RA
PORT,RA
COMPONENT,SAME
EVENT,SAME


This indicate that we have 6 data clusters. Two of them are not real data 
clusters, they identify component and events but we need to define them for 
technical reasons.

First  line indicates that data cluster IP must be transformed with the 
Relative to Access rule.


Last line indicates that cluster EVENT must be transformed with the rule SAME 
(that keeps data as it is).

** Inspect the models

You can inspect the inferred models once the inference terminates.
The csv file contains only a single component, named 0, thus a single component 
FSA is inferred.

run 
	klfaShowFSA.sh klfutput/0.ser 
in order to open the FSA

KLFA infers also a "GLOBAL" fsa that includes only the first event of a sequence 
of events belonging to a same component.


run 
	klfaShowFSA.sh klfutput/GLOBAL.ser 
in order to open the FSA


** Run the anomaly detection


By running the script named checking you can start the anomaly detection 
process.
After the execution ends you can both inspect the extended models and the 
anomalies detected.
Models are saved in folder klfaoutputs and can be inspected using klfaShoFSA.sh

Anomalies are saved in a csv file: klfaoutput/anomalies.csv
KLFA identifies three anomalies.

The first anomaly indicates that in line 13 the sequence 
"0_user modify profile__0__1),0_user profile modified__1__1),0_user logout__3__1)"

is not expected. The anomaly occurred in state q8, and KLFA was expecting 
event "modify profile__1__1)": The event are the same, "modify profile" but the
 first parameters of the expected and observed event differ: the observed one is
 "0" instead of "1". 
Since RA was used to transform data values, this anomaly means that KLFA was 
expecting a correspondence between this first parameter and the last parameter 
belonging to the same data cluster observed: the first parameter of previous 
event, "user logged in". "guest" and "Leonardo" are in fact two different values.


The second anomaly indicates that in line 23 event "0_login request for__7__1)" 
was not expected. The anomaly occurred in state q0, where KLFA was expecting 
event "0_login request for__0__1)". This anomaly is a consequence of the 
previous one: we observe the login for an already observed user, while in
 correct executions this never occurred.

The third anomaly indicates that in line 26 the last two events of the file, 
"0_DB Exception),0_Exception)" were not expected and caused the introduction 
of a tail. These two events represent exception, and they were never observed 
in valid executions.

 
** Change some configurations/inputs to better understand the tool functionalities:
	*)  add a line to correct.csv 
			for example you can add the following line, representing an event 
			of the bootstrap componen,t at the beginning of the file correct.csv
			
				BootStrap,boot
		
		repeat the whole process and see how many anomalies are detected now. 
		KLFA will indicate that an event for component BootStrap is missing

	*)change transformersConfig.txt
		this file indicates how to preprocess the data clusters:
		try the following data transformes 
			GO - Global Ordering
			RI - Relative to Instantiation
			
		you can assign different data transformation rules to different data 
		clusters
		
	*)change preprocessingRules.txt
		you can modify the regular expressions in this file to change the 
		parameters assigned to the different data clusters
		
		you can add a data cluster, but remember to add it also to 
		transformersConfig.txt
		
		you can modify 'user modify profile' and 'user profile modified' 
		this way:
		
		0,user modify profile,0:COMPONENT,1:EVENT,2:MODIFIEDUSER,3:IP	
		0,user profile modified,0:COMPONENT,1:EVENT,2:MODIFIEDUSER,3:IP
		
		and add the following line to transformersConfig.txt
		
		MODIFIEDUSER,RA	
		
		This modification put the first parameter of events 
		'user modify profile' and 'user profile modified', i.e. the name of the
		modified user, in a cluster which is different from the cluster of events
		'user modify profile', 'user logged in', 'user login request for'.
		 